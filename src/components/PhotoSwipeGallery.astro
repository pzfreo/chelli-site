---
interface Props {
  images: string[];
  title: string;
}

const { images, title } = Astro.props;
---

<div class="pswp-gallery grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="gallery">
  {images.map((image, index) => (
    <a
      href={image}
      data-pswp-width="1600"
      data-pswp-height="1200"
      target="_blank"
      class="block aspect-square overflow-hidden bg-gray-100 cursor-zoom-in"
    >
      <img
        src={image}
        alt={`${title} - Image ${index + 1}`}
        class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
        loading={index < 4 ? 'eager' : 'lazy'}
      />
    </a>
  ))}
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.css" />

<script>
  import PhotoSwipeLightbox from 'photoswipe/lightbox';
  import PhotoSwipe from 'photoswipe';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#gallery',
    children: 'a',
    pswpModule: PhotoSwipe,
    bgOpacity: 0.95,
    padding: { top: 40, bottom: 40, left: 20, right: 20 },
  });

  // Dynamically get image dimensions
  lightbox.addFilter('itemData', (itemData, index) => {
    const img = new Image();
    img.src = itemData.src as string;

    return {
      ...itemData,
      width: img.naturalWidth || 1600,
      height: img.naturalHeight || 1200,
    };
  });

  lightbox.on('uiRegister', function() {
    lightbox.pswp?.ui?.registerElement({
      name: 'counter',
      order: 5,
      isButton: false,
      appendTo: 'bar',
      onInit: (el, pswp) => {
        pswp.on('change', () => {
          el.textContent = `${pswp.currIndex + 1} / ${pswp.getNumItems()}`;
        });
      }
    });
  });

  lightbox.init();
</script>
